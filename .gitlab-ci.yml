image: python:3.10.13

variables:
  PRE_COMMIT_HOME: ${CI_PROJECT_DIR}/.cache/pre-commit

stages:
  - lint
  - test

cache:
  paths:
    - .cache/pip
    - venv/
    - ${PRE_COMMIT_HOME}

before_script:
  - python --version ; pip --version # For debugging
  - pip install virtualenv
  - virtualenv venv
  - source venv/bin/activate
  - pip install -r requirements.txt
  - pip install -r requirements-cpu.txt
  - pip install -r requirements-dev.txt
  - pip install .

lint:
  script:
    - pre-commit run --all-files

test:
  script:
    - pytest --junitxml=junit.xml
  artifacts:
    reports:
      junit: junit.xml
